---
tags: [前端]
date: 26.2.2
---

# nocode 本地开发方法

## 方法1

本地启动后直接打开 localhost:8080

限制：

只能开发线下环境， 不能开发线上环境。

原理：

线下环境 通过 info 接口 + chatId + env 获取 clientId, 如果是通过localhost访问，则env固定为test

/websso/oauth/pkce接口返回的set-cookie， 有Secure限制， 只能注入到 https 域名中，或者某些浏览器的localhost也允许注入

```
websso/token/get?client_id=f59661ae20&loginProtocol=OIDC&mode=browser&samesite=none&sdk=SSOWebOIDC_1.2.0

这个获取 token 的接口，会使用 cookie 换取 token，
```

## 方法2

把 nocode页面 的 cookie 复制到本地启动的页面即可。

注意如果是调试线上的话，不能使用localhost域名， 需要使用127.0.0.1:8080（有跨域问题，可以通过 terminal中输入` open -n -a /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --args --disable-web-security --user-data-dir="/tmp/chrome_dev_test"`启动浏览器解决），或者使用swichhosts把127.0.0.1解析到local.sankuai.com(有secure 问题 非https会导致cookie种不上)

## 方法3

1. 通过后面的命令启动浏览器， 避免非sankuai域名的跨域问题 ` open -n -a /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --args --disable-web-security --user-data-dir="/tmp/chrome_dev_test"`
2. 浏览器中打开 127.0.0.1:8080 解决cookie 种不上 + localhost域名固定env为test的问题

# 注意

如果需要调试线上环境， 需要修改 script

- 线下： "dev": "vite"
- 线上： "dev": "NODE_ENV=prod vite --mode production",

或者在terminal中输入

```
shell

# 线上
NODE_ENV=prod npx vite --mode production

# 线下
npx vite
```